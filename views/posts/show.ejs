<!DOCTYPE html>
<html>
  <head>
    <%- include('../partials/head') %>
    <title>Ohoon's Blog</title>
  </head>
  <body>
    <%- include('../partials/nav') %>
    
  <!-- Page Content -->
  <div class="container">

    <div class="row">

        <!-- Post Content Column -->
        <div class="col-lg-8">
            
            <!-- Post Head -->
            <div class="mb-4">

                <!-- Title -->
                <h1 class="mt-4"><%= postWithUser.title %></h1>

                <!-- Date/Time & Author -->
                <p>Posted on <%= postWithUser.create_date %> by <%= postWithUser.nickname %></p>

            </div>

            <hr>

            <!-- Post Body -->
            <div class="mb-4">

                <!-- Preview Image -->
                <img class="img-fluid rounded mb-4" src="http://placehold.it/900x300" alt="">

                <!-- Post Content -->
                <%- postWithUser.content %>

            </div>

            <% if (isAuthenticated && postWithUser.user_id && currentUser.id == postWithUser.user_id) { %>
                <div class="row">
                    <div class="col-lg-12">
                            <form action="/posts/<%= postWithUser.id %>?_method=delete" method="post">
                                <a href="javascript:void(0)" onClick="confirm('Do you want to delete this?')?this.parentElement.submit():null;" class="btn btn-primary float-right">Delete</a>
                            </form>
                            <a href="/posts/<%= postWithUser.id %>/edit" class="btn btn-primary float-right mx-1">Edit</a>
                    </div>
                </div>
            <% } %>
            <h5 class="mt-5">Comments<%- (commentNum>0)?` <small>(${commentNum})</small>`:`` %></h5>
            <hr>
            <!-- Comments Content -->
            <% commentsWithUser.forEach( (commentWithUser) => { %>
                <%- include('./partials/comment-show', {
                    postWithUser: postWithUser,
                    commentWithUser: commentWithUser
                }); %>
                <hr>
            <% }); %>

            <!-- Comments Form -->
            <div class="card my-4">
                <h5 class="card-header">Leave a Comment:</h5>
                <div class="card-body">
                    <form action="/comments?postId=<%= postWithUser.id %>" method="post">
                        <div class="form-group">
                            <textarea class="form-control<%= (inputErrors)&&(inputErrors.comment)&&(!inputErrors.parent)?' is-invalid':'' %>" id="content" name="content" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>

        </div>

        <!-- Sidebar Widgets Column -->
        <div class="col-md-4">
          <%- include('../widgets/search') %>
          <%- include('../widgets/category') %>
          <%- include('../widgets/side') %>
        </div>

      </div>
      <!-- /.row -->

    </div>
    <%- include('../partials/footer') %>
  </body>
</html>
