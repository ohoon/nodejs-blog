# nodejs-blog

목표:

  express.js를 기반으로 한 간단한 블로그 개발 (개인적인 공부용)

개발 노트:

  // 20.09.05
  
  express-generator로 기본 셋팅
  
  startbootstrap.com 에서 블로그형 템플릿 받아서 적용함
  
  하지만 홈 화면에 해당되는 템플릿이 없어 블로그 템플릿 참고하여 홈화면 템플릿 구현해야함
  
  홈화면 구조 (구현 예정) : 상단 >> 메인 배너, 하단 >> 최근 글 목록, 우측 >> 카테고리란(클릭 시 각 카테고리에 해당하는 블로그 포스트 목록으로 진입)

  // 20.09.06

  기존 홈화면 템플릿을 Post의 리스트에 이용할 예정이므로 옮기고

  홈화면에 메인 배너와 최근 글 목록을 볼 수 있게 템플릿을 구현함

  네비게이션 메뉴 Posts에 드롭다운메뉴를 적용해서 카테고리별로 이동할 수 있도록 세팅함

  URL은 /posts/  => 전체 글 목록, /posts/category/카테고리명 => 카테고리에 해당하는 글 목록

  // 20.09.07

  Mysql를 이용해서 Post의 데이터들을 저장함

  우선 CRUD에서 Create, Read만 구현함

  홈화면에서 최근 글 목록을 확인할 수 있고

  블로그화면에서 전체 글 목록을 확인할 수 있고 New 버튼으로 글 작성 페이지로 넘어가서 Create 가능하게끔 구현함

  다음 작업 때는 Update와 Delete을 우선적으로 구현할 예정

  // 20.09.08
  
  Update, Delete 하기 전에 먼저 글 보기 페이지를 구현하고자 함

  Read More 버튼을 누르면 글의 id를 Where조건으로 하여 글의 제목, 내용을 추출해서 보여줌

  댓글 기능도 마찬가지로 CRUD 이후에 구현 예정

  // 20.09.09

  글 보기 페이지 아래쪽에 Edit, Delete, Back 버튼 추가

  Edit의 경우는 버튼 클릭 시 Edit Form 화면으로 넘어가서 해당 글의 데이터를 불러오고 수정.
  
  그 후에 submit하면 HTTP method의 PUT으로 데이터를 받아 Mysql에서 Update 처리하고 해당 글로 redirect

  Delete의 경우는 버튼 클릭 시 삭제하겠냐는 경고창을 띄우고 예. 라고 답할 시 HTTP method의 DELETE로 글 번호를 받아 Mysql에서 Delete 처리하고 글 목록으로 redirect

  다음 작업 때는 간단하게 회원가입과 로그인을 할 수 있도록 구현할 예정

  // 20.09.10

  상단 nav 바에 로그인/ 회원가입 버튼을 만들고 회원가입 버튼을 누르면 회원가입 페이지로 넘어감

  개인정보를 입력하고 SIGN UP 버튼을 누르면 users 테이블에 저장. 패스워드는 bcrypt로 암호화처리

  다음 작업 때는 로그인 페이지를 만들고 passport를 이용해서 사용자 로그인/세션을 구현할 예정

  // 20.09.11

  상단 nav 바에 로그인 버튼을 누르면 login form으로 이동

  입력값 검증을 하여 누락된 입력데이터가 있거나 Username과 Password가 일치하지 않는 계정일 경우

  connect-flash를 이용하여 에러메시지를 출력하도록 구현함

  로그인에 성공하면 passport local-strategy를 사용해서 세션에서 사용자의 id 값을 가지고 관리함

  세션에 정상적으로 로그인된 것이 확인이 되면 상단 nav바는 username과 로그아웃 버튼이 보여지게 되고

  로그아웃 버튼을 누르면 정상적으로 세션에서 로그인 정보는 폐기되고 로그인 전 화면과 같이 돌아가게 됨

  다음 작업 때는 게시물 작성 form과 회원가입 form에 입력 데이터 검증 기능을 추가할 예정임

  // 20.09.12

  이제 게시물을 작성하기 직전에 각 input의 value을 조사해서 title과 category의 값을 반드시 입력해야 작성할 수 있게끔 구현함

  회원가입도 마찬가지로 필수 사항은 input box는 submit할때 반드시 값이 존재해야 하고,

  username의 경우 최소 5, 최대 20의 글자 제한, password의 경우 최소 8, 최대 40의 글자 제한을 뒀음

  password와 confirm password가 다를 경우 또한 경고를 띄우며 이미 존재하는 username이 있을 시에도 경고를 띄움

  회원가입을 성공적으로 마치면 자동적으로 login()을 통해 로그인됨

  다음 작업 때는 category의 db구조를 설계하고 글목록/작성에 카테고리를 반영할 수 있게끔 구현할 예정

  시간이 남으면 글작성 에디터 라이브러리를 하나 가져와서 넣어야겠음

  // 20.09.13

  작업 시간이 별로 없어서 에디터부터 넣기로 함

  script문으로 ckeditor.js를 불러와 기존 textarea를 교체함

  edit 페이지도 마찬가지로 ckeditor을 넣어주고 누락되었던 input check 기능도 구현해줌

  문제가 생긴게 게시물 보기 등등 ejs로 보여주는 페이지에서 html 태그들이 encode되서 정상적으로 적용이 되지 않았음

  <%=이 아니라 <%-을 사용하면 정상적으로 출력됨을 확인, 수정했음

  // 20.09.14

  카테고리 테이블(id: Int, name: Varchar(30))을 만들어서 글 목록을 카테고리 별로 보여주도록 했음

  화면 상단 nav바의 posts 드롭다운 메뉴에서 카테고리를 고를 수 있고, 우측 카테고리 위젯에서도 마찬가지로 선택할 수 있음

  글 목록 헤더에는 카테고리 명이 삽입되어 보여줌
  
  헤더 바로 아래에 있는 사이드 메뉴는 Home / {카테고리 명} 으로 현재 위치를 보여주는데,

  Home을 클릭할 시 전체 게시물을 볼 수 있는 화면으로 넘어감

  다음 작업 때는 post를 보여줄 때 작성자 이름을 표시하고, 작성자만이 글 수정/삭제 할 수 있도록 접근제어 기능을 구현할 예정

  // 20.09.15

  게시물을 작성하면 posts 테이블의 user_id 컬럼에 작성자 id를 삽입하게 함

  그 후에 posts 리스트나 상세 페이지를 열 때, posts의 user_id 컬럼을 기준으로 users 테이블과 inner join해서 작성자의 nickname을 가져와서 사용하게 함

  postDAO의 select 쿼리들이 불필요한 정보까지 가져와서 사용하는 컬럼만 가져오도록 수정함

  게시물 작성/수정 form에서 현재 카테고리 목록을 가져오도록 수정함

  이제 다음 작업에 글쓰기/수정/삭제 버튼이나 프로세스를 현재 로그인한 유저 정보와 작성자를 비교해서 접근을 제어하도록 구현할 예정임

  // 20.09.16

  이제 글 작성 버튼은 회원에게만 보이고 url로 강제로 들어가도 로그인 상태가 아니면 로그인 화면으로 redirect 됨

  글 수정과 삭제 버튼은 작성자에게만 보이고 글 작성과 마찬가지로 작성자가 아니면 홈화면으로 돌아감

  그 외에 패스워드 암호화 하는 부분을 crypt.js로 모듈화시켜 보안성과 유지보수성을 높였고,

  input 값이 null 값인지 체크하는 부분 역시 모듈화하여 코드가 간결해짐

  다음에 할 작업은 페이징 기능 구현이다.

  // 20.09.17

  mysql 환경에서 SELECT COUNT(*) FROM posts로 전체 게시물의 개수를 구해서

  페이징할 단위로 나누어 전체 페이징 넘버를 연산함

  전체 페이징 넘버를 10개 단위로 나눠서 하단 페이징 바에서 넘어갈 수 있게 구현함

  이제 각 페이지에 대한 정보는 쿼리스트링으로 넘어가고

  쿼리스트링으로 받은 페이지 넘버를 확인해서 LIMIT offset, limit을 사용해

  현재 페이지에 해당하는 글들의 목록만 불러오도록 구현함

  그 외에 양 쪽 화살표 버튼을 구현해서 10개 단위로 빨리 넘어갈 수 있도록 했음

  다음 작업은 이제 New 버튼이나 Edit 버튼과 같이 다른 화면으로 갔다가 다시 돌아올 때 무조건 /posts로 가는 것이 아니라

  전에 있었던 화면으로 돌아가도록 구현할 예정이다. 글 작성 시 현재 보고 있는 카테고리를 자동으로 지정해주는 것도 포함.

  // 20.09.18

  먼저 기존 게시글 show 화면에서 back버튼에 querystring을 통해서 전의 페이지의 페이징 상태를 전달하려고 했는데

  그냥 뒤로가기 버튼누르면 되는데 굳이 back 버튼에 복잡한 과정을 넣을 필요가 있나 싶어서 back버튼은 삭제했음

  그리고 제목/본문으로 검색을 할 수 있는 기능을 구현했음

  우측 검색 위젯에서 검색어를 적고 Go! 버튼을 누르면 검색어가 queryString으로 넘어가

  WHERE title LIKE '%검색어%' 이런 식으로 postDAO 쿼리에 삽입되어 보여주도록 했음

  카테고리 별로도 검색이 되어야 하기 때문에 전체 글 보기 상태에서 검색하면 전체 글에서 검색하고,

  카테고리 안에서 검색하면 카테고리 안에서 검색이 되게 설정해놨음

  다음 작업 때는 댓글 기능을 구현해볼 것이다.

  // 20.09.19

  posts의 show 화면 하단에 댓글 창을 만들어서 댓글 입력 form에 데이터를 넣고 submit하면

  comments 테이블에 데이터가 삽입되고, comments 테이블의 post_id와 같은 댓글들을 모아서 댓글창에서 보여줌

  거기에 삭제 버튼을 만들어서 댓글을 작성한 사용자만이 삭제 버튼을 볼 수 있음

  삭제 버튼을 누르면 댓글의 isDeleted가 1이 되고 show화면 출력 시에 isDeleted를 검사해서
  
  1이면 댓글의 내용을 (Deleted Comment)라고 표시하여 다른 사용자는 원래 댓글 내용을 볼 수 없게 됨

  다음 작업 때는 대댓글 기능을 구현하겠음

  // 20.09.20

  댓글 삭제버튼 옆에 대댓글 작성하는 버튼이 생겼음

  이 버튼을 누르면 숨겨져있던 댓글 작성 form이 보이며 대댓글을 작성할 수 있게 됨

  submit하면 기존 댓글과 같이 db에 저장이 되는데, parent_comment_id가 댓글 id로 지정이 됨

  대댓글을 보여주기 위해 우선 댓글 리스트를 트리 구조로 바꿔야 함

  최신 댓글부터 탐색해서 댓글의 parent가 있으면 부모 댓글의 자식 값으로 해당 댓글을 넣고 리스트에서 지움

  이런식으로 반복하면 부모 노드가 없는 댓글들로 이루어져 있고, 각 한 부모 댓글의 자식 값에 자식 댓글들 정보가 담겨 있게 구현함

  웹에서 불러올 때 댓글 정보를 불러오는데, 댓글의 자식 값이 존재하면 재귀적으로 댓글 form 자기 자신을 자식 댓글 상대로 다시 불러옴

  그렇게 되면 더 이상 자식이 없을 때까지 댓글 정보를 불러오고 다음 최상위 댓글로 넘어가게 됨

  다음 작업 때는 posts 리스트를 불러올 때 댓글 수도 불러와서 표시해주는 기능을 구현할 것이다.

  // 20.09.21

  기존 post find query를 comments 테이블과 join한 후, group by -> count()해서 댓글의 개수를 구할 수 있도록 수정하였음
  
  따라서 글 목록 화면이 뜨면 각 post마다 댓글 개수를 확인할 수 있게 되었음

  댓글 개수를 show.ejs에 파라미터로 넘겨줘서 show 화면에서도 Comment 옆에 댓글 개수를 나타낼 수 있게 되었음

  다음 작업 때는 글의 조회수를 나타낼 수 있도록 구현할 예정이다.

  // 20.09.22

  오늘은 비교적 간단하게 구현할 수 있었다.

  posts 테이블에 views 칼럼을 추가하고 글을 읽을 때마다 1씩 증가시켜주면 되는 심플한 작업임

  dao에서 views 수치를 증가시키는 method를 추가하고 router에서 글 read하는 페이지로 접근할때 이 메서드를 불러옴

  사용자는 증가된 조회수를 확인할 수 있게 된다.

  다음 작업 때는 글 목록 리스트와 글 보기 화면을 좀 더 세련되게 바꾸는 작업을 할 것이다.

  // 20.09.23

  우선 글 목록 화면과 글 보기 화면에 걸리적거리던 썸네일 요소를 삭제하였음

  글 목록 화면에서 글 보기로 넘어가는 버튼을 삭제하고 post title을 누르면 해당 글 보기 화면으로 넘어가도록 구현함

  그 외에 css로 a태그를 조정해주고 글 목록화면에서의 글 제목 max-height를 2줄, 글 내용 height를 3줄로 설정하고 넘어가는 overflow는 ... 으로 표현되게 하였음

  폰트를 나눔고딕으로 바꾸고 적용했음

  우측에 있는 카테고리 위젯을 좀더 테이블 형식으로 바꾸는게 더욱 깔끔해 보일 것 같다.

  다음 작업 때도 전체적인 화면 구조를 손봐야할듯.. 

  // 20.09.24

  우측에 자리만 차지하던 위젯들을 없애버리고 검색 위젯은 글 목록 화면의 카테고리 타이틀 우측에 삽입했음

  글 목록 페이지의 디자인을 많이 개선했음

  블로그의 목적에 맞게 최대한 정보 전달에 필요한 것만 심플하게 배치했음

  우측 썸네일은 추후에 파일 첨부 기능 구현 후에 다룰 예정임

  아이콘들은 font awesome에 있는 것들을 이용했음

  글 보기 화면도 마찬가지로 깔끔하게 재배치했음.. 확실히 우측 위젯을 없애니까 화면도 넓어져서 시야가 확 트여 시원한 느낌이 듦

  다음 작업은 파일 첨부 기능을 구현해볼 예정이다!




